#include "ftgmac030.h"

void wake_up_isr(FTGMAC030_Control *ctrl)
{
	
}

static unsigned char wake_up_frame[200]=
                       {
                        0x41, 0x23, 0x76, 0x45, 0xBA, 0x89, 0x00, 0x01, 0xFF, 0xFF, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07
                       ,0x08, 0x09, 0xFF, 0xFF, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15
                       ,0x16, 0x17, 0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F, 0x20, 0x21, 0x22, 0x23, 0x24, 0x25
                       ,0x26, 0x27, 0x28, 0x29, 0x2A, 0x2B, 0x2C, 0x2D, 0x2E, 0x2F, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35
                       ,0x36, 0x37, 0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F, 0x40, 0x41, 0x42, 0x43, 0x44, 0x45
                       ,0x46, 0x47, 0x48, 0x49, 0x4A, 0x4B, 0x4C, 0x4D, 0x4E, 0x4F, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55
                       ,0x56, 0x57, 0x58, 0x59, 0x5A, 0x5B, 0x5C, 0x5D, 0x5E, 0x5F, 0x60, 0x61, 0x62, 0x63, 0x64, 0x65
                       ,0x66, 0x67, 0x68, 0x69, 0x6A, 0x6B, 0x6C, 0x6D, 0x6E, 0x6F, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75
                       ,0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA
                       ,0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB, 0xBB
                       ,0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC
                       ,0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD
                       ,0xEE, 0xEE, 0xEE, 0xEE, 0xEE, 0xEE, 0xEE, 0xEE
                      };

void wakeup_test_main(FTGMAC030_Control *ctrl)
{
	int i;

	ctrl->open(ctrl, wake_up_isr);
	prints("---1. Link Status Change.------------------------------------------------------\n");
	ctrl->enter_power_down(ctrl, FTGMAC030_WOLCR_LINKCHG0,
			       wake_up_frame, sizeof(wake_up_frame));
	prints("MAC is in the sleep mode, link down and up the PHY to trigger link status change...\n");
	ctrl->exit_power_down();
	prints("Ethernet Wake Up...\n");

	prints("---2. Magic Frame Event.-------------------------------------------------------\n");
	ctrl->open(ctrl, wake_up_isr);
	if (0 == ctrl->is_link_up(ctrl)) {
		prints("Please let link up!\n");
		prints("Waiting for link up ...\n");
		/* wait for link up */
		while(!ctrl->is_link_up(ctrl));
	}
	ctrl->enter_power_down(ctrl, FTGMAC030_WOLCR_MAGICPKT, wake_up_frame, sizeof(wake_up_frame));
	prints("MAC is in the sleep mode, please send a magic frame from the remote...\n");
	ctrl->exit_power_down();
	prints("Ethernet Wake Up...\n");

	prints("---3. Wake-up Frame Event.-----------------------------------------------------\n");
	for (i = 3; i <= 6; i++) {
		ctrl->open(ctrl, wake_up_isr);

		ctrl->set_wakeup_mask(ctrl, 0xfff3fcff, 1);
		ctrl->set_wakeup_mask(ctrl, 0xffffffff, 2);
		ctrl->set_wakeup_mask(ctrl, 0xffffffff, 3);
		ctrl->set_wakeup_mask(ctrl, 0xffffffff, 4);

		prints("Wake Up frame %d ...\n", i - 2 );
		ctrl->enter_power_down(ctrl, (1 << i), wake_up_frame, sizeof(wake_up_frame));
		prints("MAC is in the sleep mode, please send a wake-up frame from the remote...\n");
		ctrl->exit_power_down();
		prints("Ethernet Wake Up...\n");
	}
}
